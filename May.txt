# main.py
import streamlit as st
from chatbot import chat, get_history
from api_docs import dados_api

# Configuração da página
st.set_page_config(page_title="Chat de Projetos", layout="wide")
st.title("🤖 Chat de Projetos com LLM (Ollama)")

# Inicializa histórico no frontend
if "messages" not in st.session_state:
    st.session_state.messages = []

# Exibe histórico salvo
for msg in st.session_state.messages:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])

# Entrada do usuário
if pergunta := st.chat_input("Digite sua pergunta sobre os projetos..."):
    # Mostra pergunta
    with st.chat_message("user"):
        st.markdown(pergunta)
    st.session_state.messages.append({"role": "user", "content": pergunta})

    # Resposta do bot (streaming)
    with st.chat_message("assistant"):
        resposta = st.write_stream(chat(pergunta))
    st.session_state.messages.append({"role": "assistant", "content": resposta})

# Sidebar
with st.sidebar:
    st.subheader("📌 Histórico de Memória")
    history = get_history()
    for h in history.messages:
        st.markdown(f"**{h.type}:** {h.content}")

    st.subheader("📊 Dados da API")
    st.json(dados_api[:3])  # só mostra 3 registros
