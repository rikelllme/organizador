import streamlit as st
from api_client import get_projetos
from chatbot import responder_pergunta

st.set_page_config(page_title="Chat de Projetos", layout="wide")
st.title("游눫 Chat de Projetos com LLM")

# Inicializa hist칩rico na sess칚o
if "history" not in st.session_state:
    st.session_state.history = []

# Carrega dados da API (uma vez)
if "dados_api" not in st.session_state:
    st.session_state.dados_api = get_projetos()

# Mostra dados da API em painel expans칤vel
with st.expander("游늯 Dados carregados da API"):
    st.json(st.session_state.dados_api)

# Entrada do usu치rio
user_input = st.text_input("Digite sua pergunta:")

if st.button("Enviar") and user_input.strip():
    # Gera resposta usando chatbot.py
    resposta = responder_pergunta(user_input, st.session_state.dados_api)

    # Atualiza hist칩rico
    st.session_state.history.append({"user": user_input, "bot": resposta})

# Exibe hist칩rico de conversa
for msg in st.session_state.history:
    st.markdown(f"**Voc칡:** {msg['user']}")
    st.markdown(f"**Bot:** {msg['bot']}")
    st.markdown("---")
